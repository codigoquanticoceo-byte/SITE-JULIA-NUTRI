<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Júlia Clementino Nutricionista - Login</title>

<style>
:root {
  --laranja: #F28C28;
  --preto: #1D1D1D;
  --branco: #FFFFFF;
  --vinho: #E0006C;
}

*, *::before, *::after {
  box-sizing: border-box;
}

img {
  max-width: 100%;
  height: auto;
}

body {
  margin: 0;
  padding: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(to right, var(--laranja), var(--branco) 55%);
  min-height: 100vh;
}

/* BARRA SUPERIOR */
.top-bar {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  padding: 16px 40px;
}

.cta-button {
  text-decoration: none;
  padding: 10px 28px;
  border-radius: 999px;
  font-size: 14px;
  font-weight: bold;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: var(--branco);
  background-color: var(--preto);
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
}

/* MENU SUPERIOR */
.menu-container {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 20px;
}

.menu {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  gap: 22px;
  background-color: var(--preto);
  padding: 10px 16px;
  border-radius: 40px;
  position: relative;
}

.menu a {
  text-decoration: none;
  color: var(--branco);
  font-size: 15px;
  padding: 10px 18px;
  border-radius: 30px;
  transition: 0.3s;
  white-space: nowrap;
}

.menu a:hover {
  background-color: var(--laranja);
}

/* CARRINHO */
.cart-btn {
  margin-left: 4px;
  position: relative;
  width: 44px;
  height: 44px;
  border-radius: 999px;
  background: linear-gradient(145deg, #2a2a2a, #111);
  border: 1px solid rgba(255,255,255,0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.cart-icon { width: 22px; height: 22px; }

.cart-count {
  position: absolute;
  top: -6px;
  right: -6px;
  min-width: 20px;
  height: 20px;
  background: var(--vinho);
  color: var(--branco);
  font-size: 12px;
  font-weight: bold;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.admin-gear {
  position: absolute;
  right: -34px;
  top: 50%;
  transform: translateY(-50%);
  width: 20px;
  height: 20px;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  color: var(--laranja);
  background: transparent;
  border: none;
  text-decoration: none;
  cursor: pointer;
  transition: transform 0.2s ease, color 0.2s ease;
}

.admin-gear:hover {
  transform: translateY(-50%) rotate(90deg);
  color: var(--vinho);
}

/* LOGO */
.top-logo {
  display: flex;
  justify-content: center;
  margin-top: 10px;
}

.top-logo img {
  width: 180px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.25);
  border: 4px solid var(--laranja);
}

/* CONTADOR DE VISITAS */
.visit-counter-strip {
    width: 100%;
    display: flex;
    justify-content: center;
    margin-top: 18px;
    padding: 0 20px;
}

.visit-counter {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 18px;
    border-radius: 999px;
    background: rgba(29, 29, 29, 0.9);
    color: var(--branco);
    font-size: 14px;
    line-height: 1.4;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
}

.visit-counter__value {
    font-weight: bold;
    font-size: 17px;
    letter-spacing: 0.04em;
    color: var(--laranja);
}


@media (max-width: 768px) {
  .top-bar {
    justify-content: center;
    padding: 12px 20px;
  }

  .menu-container {
    margin-top: 14px;
    padding: 0 12px;
  }

  .menu {
    gap: 12px;
    padding: 12px 18px;
  }

  .menu a {
    font-size: 14px;
    padding: 8px 14px;
  }

  .top-logo img {
    width: 140px;
  }

  .quadro {
    width: 90%;
    padding: 28px 20px;
  }

  .form-grid {
    grid-template-columns: 1fr;
  }

  .row {
    flex-direction: column;
    align-items: flex-start;
  }
}

/* QUADRO */
.quadro {
  width: 70%;
  max-width: 900px;
  background-color: var(--preto);
  margin: 50px auto;
  padding: 40px;
  border-radius: 30px;
  color: var(--branco);
  box-shadow: 0 0 25px rgba(0, 0, 0, 0.35);
  text-align: left;
}

.quadro h2 {
  margin-top: 0;
  color: var(--laranja);
  font-size: 28px;
}

.quadro p {
  font-size: 16px;
  line-height: 1.5;
  color: rgba(255,255,255,0.92);
}

/* FORM */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-top: 18px;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.field label {
  font-size: 14px;
  color: rgba(255,255,255,0.92);
}

.input {
  height: 44px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.2);
  background: #2a2a2a;
  color: var(--branco);
  padding: 0 14px;
  outline: none;
}

.input:focus {
  border-color: rgba(242, 140, 40, 0.9);
  box-shadow: 0 0 0 3px rgba(242, 140, 40, 0.15);
}

.full { grid-column: 1 / -1; }

.row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
  margin-top: 16px;
}

.btn {
  display: inline-block;
  padding: 10px 22px;
  border-radius: 999px;
  text-decoration: none;
  font-weight: bold;
  border: 0;
  cursor: pointer;
  transition: 0.25s;
}

.btn-primary {
  background-color: var(--laranja);
  color: var(--preto);
}

.btn-primary:hover {
  background-color: var(--vinho);
  color: var(--branco);
}

.btn-outline {
  background: transparent;
  color: var(--branco);
  border: 1px solid rgba(255,255,255,0.25);
}

.btn-outline:hover {
  border-color: rgba(255,255,255,0.6);
}

.btn-danger {
  background: transparent;
  color: var(--branco);
  border: 1px solid rgba(224,0,108,0.55);
}

.btn-danger:hover {
  border-color: rgba(224,0,108,0.95);
  box-shadow: 0 0 0 3px rgba(224,0,108,0.12);
}

.message {
  margin-top: 16px;
  padding: 12px 14px;
  border-radius: 14px;
  background: #2a2a2a;
  border: 1px solid rgba(255,255,255,0.12);
  display: none;
}

.message.ok { border-color: rgba(242, 140, 40, 0.65); }
.message.err { border-color: rgba(224, 0, 108, 0.65); }

.message strong { color: var(--laranja); }

@media (max-width: 780px) {
  .quadro { width: 86%; padding: 26px; }
  .form-grid { grid-template-columns: 1fr; }
}
</style>
</head>

<body>

<div class="top-bar">
  <a href="conheca.html" class="cta-button">Conheça meu trabalho</a>
</div>

<div class="top-logo">
  <img src="logo-arte.png" alt="Logo Júlia Clementino Nutricionista">
</div>

<div class="menu-container">
  <nav class="menu">
    <a href="index.html">PLANILHAS PROFISSIONAIS</a>
    <a href="gestao-uan.html">GESTÃO UAN</a>
    <a href="treinamento-manipulacao.html">TREINAMENTO DE MANIPULAÇÃO</a>
    <a href="cadastro.html">CADASTRO</a>
    <a href="login.html">LOGIN</a>

    <button class="cart-btn" id="cartBtn" aria-label="Carrinho">
      <svg class="cart-icon" viewBox="0 0 24 24" fill="none">
        <path d="M3 4h2l2.2 9.2a2 2 0 0 0 2 1.6h7.5a2 2 0 0 0 2-1.6L21 7H6"
              stroke="#FFFFFF" stroke-width="1.8" stroke-linecap="round"/>
        <circle cx="10" cy="20" r="1.4" fill="#FFFFFF"/>
        <circle cx="18" cy="20" r="1.4" fill="#FFFFFF"/>
      </svg>
      <span class="cart-count" id="cartCount">0</span>
    </button>

    <a href="admin.html" id="adminBtn" class="admin-gear" title="Painel Administrativo" aria-label="Admin">⚙</a>
  </nav>
</div>
<div class="visit-counter-strip">
    <div class="visit-counter" aria-live="polite">
        <span class="visit-counter__label">Visitas registradas:</span>
        <span class="visit-counter__value" id="visitCountDisplay">carregando...</span>
    </div>
</div>

<div class="quadro">
  <h2>Login</h2>
  <p>Entre com seu email e senha cadastrados para acessar sua conta.</p>

  <form id="loginForm" novalidate>
    <div class="form-grid">
      <div class="field full">
        <label for="emailLogin">Email</label>
        <input class="input" id="emailLogin" name="emailLogin" type="email"
               placeholder="seuemail@exemplo.com" autocomplete="email" />
      </div>

      <div class="field full">
        <label for="senhaLogin">Senha</label>
        <input class="input" id="senhaLogin" name="senhaLogin" type="password"
               placeholder="Digite sua senha" autocomplete="current-password" />
      </div>
    </div>

    <div class="row">
      <button class="btn btn-primary" type="submit">Entrar</button>
      <a class="btn btn-outline" href="cadastro.html">Criar conta</a>
      <a class="btn btn-outline" href="index.html">Voltar</a>
      <button class="btn btn-danger" id="btnSair" type="button" style="display:none;">Sair</button>
    </div>

    <div class="message ok" id="msgOk"></div>
    <div class="message err" id="msgErr"></div>
  </form>
</div>

<script src="./assets/js/cart.js"></script>
<script src="./assets/js/visit-counter.js"></script>
<script src="./assets/js/config.js"></script>
<script type="module" src="./assets/js/supabase-client.js"></script>
<script src="./assets/js/auth.js"></script>
<script>
document.getElementById("cartBtn").addEventListener("click", function () {
  window.location.href = "carrinho.html";
});

const supabaseGetter = () => window.supabaseClient;
const authHelper = window.Auth;

function $(id) { return document.getElementById(id); }

function showError(text) {
  const el = $("msgErr");
  el.style.display = "block";
  el.textContent = text;

  const ok = $("msgOk");
  ok.style.display = "none";
  ok.textContent = "";
}

function showOk(htmlText) {
  const ok = $("msgOk");
  ok.style.display = "block";
  ok.innerHTML = htmlText;

  const el = $("msgErr");
  el.style.display = "none";
  el.textContent = "";
}

function isValidEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(email || "").trim());
}

const loginForm = $("loginForm");
const submitBtn = loginForm.querySelector("button[type='submit']");
const signOutBtn = $("btnSair");
const submitDefaultText = submitBtn.textContent;

const setLoading = (isLoading) => {
  submitBtn.disabled = isLoading;
  submitBtn.textContent = isLoading ? "Entrando..." : submitDefaultText;
};

const waitForSession = async () => {
  if (authHelper?.ready) {
    await authHelper.ready();
  }
  return authHelper?.getSession?.() || null;
};

const refreshUI = async () => {
  const session = await waitForSession();
  if (session?.email) {
    signOutBtn.style.display = "inline-block";
    showOk(`<strong>Você já está logado.</strong> Olá, ${session.nome || session.email}.`);
  } else {
    signOutBtn.style.display = "none";
    $("msgOk").style.display = "none";
    $("msgOk").textContent = "";
  }
};

authHelper?.onSessionChange?.(() => {
  refreshUI();
});

signOutBtn.addEventListener("click", async () => {
  const supabase = supabaseGetter();
  if (!supabase) {
    showError("Supabase não configurado. Atualize a página e tente novamente.");
    return;
  }
  try {
    await authHelper?.signOut?.();
    showOk(`<strong>Você saiu.</strong> Login encerrado com sucesso.`);
    $("emailLogin").value = "";
    $("senhaLogin").value = "";
  } catch (error) {
    showError("Não foi possível encerrar a sessão. Tente novamente.");
  }
});

loginForm.addEventListener("submit", async (event) => {
  event.preventDefault();

  const supabase = supabaseGetter();
  if (!supabase) {
    return showError("Supabase não configurado. Atualize a página e tente novamente.");
  }

  const email = $("emailLogin").value.trim();
  const senha = $("senhaLogin").value;

  if (!email || !isValidEmail(email)) return showError("Informe um email válido.");
  if (!senha) return showError("Informe sua senha.");

  setLoading(true);
  try {
    const { error } = await supabase.auth.signInWithPassword({ email, password: senha });
    if (error) {
      return showError(error.message || "Não foi possível realizar o login.");
    }
    showOk(`<strong>Login realizado.</strong> Bem-vindo(a)!`);
  } catch (error) {
    showError("Erro inesperado ao tentar conectar. Tente novamente.");
  } finally {
    setLoading(false);
  }
});

refreshUI();
</script>

</body>
</html>



